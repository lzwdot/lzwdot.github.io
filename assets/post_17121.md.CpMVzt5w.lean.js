import{_ as i,c as a,a4 as n,o as l}from"./chunks/framework.BudGbe4l.js";const o=JSON.parse('{"title":"单域名（localhost）下访问多个 Laravel 项目","description":"","frontmatter":{"date":"2018-05-10 14:37:26","author":"lzw"},"headers":[],"relativePath":"post/17121.md","filePath":"post/2018/05/17121.md","lastUpdated":1710426988000}'),e={name:"post/17121.md"};function p(t,s,h,k,r,d){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="单域名-localhost-下访问多个-laravel-项目" tabindex="-1">单域名（localhost）下访问多个 Laravel 项目 <a class="header-anchor" href="#单域名-localhost-下访问多个-laravel-项目" aria-label="Permalink to &quot;单域名（localhost）下访问多个 Laravel 项目&quot;">​</a></h1><p>一个服务器不能配置多个子域名的时候很是尴尬，无法使用虚拟目录，只能通过二级目录访问。在根目录 <code>/data/wwwroot/default</code> 部署了多个 Laravel 应用，例如 <code>laravel1</code>，<code>laravel2</code>…，然后按文档配置所谓的优雅链接，遇到了诸多问题：</p><ul><li>Apache 服务器：XAMPP 的 LAMP 环境</li><li>Nginx 服务器：OneinStack 自动部署 LNMP 环境</li></ul><h4 id="apache-服务器" tabindex="-1">Apache 服务器 <a class="header-anchor" href="#apache-服务器" aria-label="Permalink to &quot;Apache 服务器&quot;">​</a></h4><p>在 LAMP 环境下使用还是蛮简单，配置 <code>Laravel/public/.htaccess</code>：</p><div class="language-apache vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">apache</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> +FollowSymLinks</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RewriteEngine</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> On</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{REQUEST_FILENAME}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !-d</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RewriteCond</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> %{REQUEST_FILENAME}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> !-f</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RewriteRule</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.php</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [L]</span></span></code></pre></div><p>即可，访问的地址：</p><ul><li><a href="http://test.com/laravel1/public/admin/index" target="_blank" rel="noreferrer">http://test.com/laravel1/public/admin/index</a></li><li><a href="http://test.com/laravel2/public/admin/index" target="_blank" rel="noreferrer">http://test.com/laravel2/public/admin/index</a></li></ul><h4 id="nginx-服务器" tabindex="-1">Nginx 服务器 <a class="header-anchor" href="#nginx-服务器" aria-label="Permalink to &quot;Nginx 服务器&quot;">​</a></h4><p>文档中说，只要在 <code>nginx.conf</code> 下配置：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try_files </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$uri $uri/ /index.php?$query_string;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>即可，访问优雅链接，但结果有点失望，你会遇到问题：</p><ol><li>Access denied.</li><li>No input file specified.</li><li>504</li><li>…</li></ol><p>归根结底是 <code>nginx.conf</code> 配置问题，本人遇到最多就是 Access denied，因为使用 OneinStack 自动部署 LNMP 环境，<code>nginx.conf</code> 已经默认配置了，结果仔细对比，少了下面配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fastcgi_split_path_info </span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">      ^(.+.php)(.*)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><blockquote><p>参考：<a href="https://segmentfault.com/a/1190000002667095" target="_blank" rel="noreferrer">https://segmentfault.com/a/1190000002667095</a></p></blockquote><p>难怪 Laravel 优雅链接 <code>index.php</code> 后面一直无法访问，目前问题已解决，附上一段网上的配置：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$root_path </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/data/www/default&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$root_path;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.php index.html index.htm;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try_files </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$uri $uri/ @rewrite;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @rewrite </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/(.*)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /index.php?_url=/$1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .php </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fastcgi_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">127.0.0.1:9000;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fastcgi_index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/index.php;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fastcgi_split_path_info </span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">      ^(.+.php)(/.+)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fastcgi_param </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PATH_INFO       $fastcgi_path_info;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fastcgi_param </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PATH_TRANSLATED $document_root$fastcgi_path_info;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fastcgi_param </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SCRIPT_FILENAME $document_root$fastcgi_script_name;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      fastcgi_params;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~*</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/(css|img|js|flv|swf|download)/(.+)$ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$root_path;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /.ht </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        deny </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p><a href="http://test.com/laravel1/public/index.php/admin/index" target="_blank" rel="noreferrer">http://test.com/laravel1/public/index.php/admin/index</a><br><a href="http://test.com/laravel2/public/index.php/admin/index" target="_blank" rel="noreferrer">http://test.com/laravel2/public/index.php/admin/index</a></p></blockquote><p>都可以正常访问了，OK!</p><h4 id="最后隐藏-index-php" tabindex="-1">最后隐藏 index.php <a class="header-anchor" href="#最后隐藏-index-php" aria-label="Permalink to &quot;最后隐藏 index.php&quot;">​</a></h4><p>虽然上述配置在 Laravel 中可以正常访问，但是一些放在 <code>public</code> 里面的静态资源可能无法访问，比如无法使用 <code>asset()</code> 函数时，路径中就包含 <code>index.php</code> 导致资源无法加载，所以建议隐藏 <code>index.php</code></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!-e </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$request_filename) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/(.*)/public/(.*)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /$1/public/index.php/$2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 或者</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/(.*)/public/ /$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1/public/index.php?$query_string </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 推荐</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p><a href="http://test.com/laravel1/public/admin/index" target="_blank" rel="noreferrer">http://test.com/laravel1/public/admin/index</a><br><a href="http://test.com/laravel2/public/admin/index" target="_blank" rel="noreferrer">http://test.com/laravel2/public/admin/index</a></p></blockquote><p>以上就无需加 <code>index.php</code>，即可正常访问。</p>`,25)]))}const E=i(e,[["render",p]]);export{o as __pageData,E as default};
