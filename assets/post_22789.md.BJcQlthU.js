import{_ as i,c as t,o as a,aj as h}from"./chunks/framework.DIIbMIHw.js";const o=JSON.parse('{"title":"宝塔重新编译 Nginx，隐藏 Server 信息和版本信息","description":"","frontmatter":{"date":"2019-04-03 08:57:00","author":"lzw"},"headers":[],"relativePath":"post/22789.md","filePath":"post/2019/04/22789.md","lastUpdated":1710426988000}'),e={name:"post/22789.md"};function n(l,s,p,k,r,d){return a(),t("div",null,[...s[0]||(s[0]=[h('<h1 id="宝塔重新编译-nginx-隐藏-server-信息和版本信息" tabindex="-1">宝塔重新编译 Nginx，隐藏 Server 信息和版本信息 <a class="header-anchor" href="#宝塔重新编译-nginx-隐藏-server-信息和版本信息" aria-label="Permalink to “宝塔重新编译 Nginx，隐藏 Server 信息和版本信息”">​</a></h1><p><strong>环境</strong><br> 系统: CentOS Linux 7.6.1810 (Core)<br> 宝塔：免费版 5.9.1<br> Nginx版本：1.15</p><p><strong>需求</strong><br> 隐藏 Nginx 的 server 信息和版本信息</p><h2 id="修改配置和源码" tabindex="-1">修改配置和源码 <a class="header-anchor" href="#修改配置和源码" aria-label="Permalink to “修改配置和源码”">​</a></h2><ol><li>隐藏版本信息</li></ol><p>在 <code>nginx.conf</code> 里面添加</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server_tokens </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ol start="2"><li>隐藏 server 信息（需要重新编译 Nginx）</li></ol><p>进入 Nginx 源码目录 <code>/www/server/nginx/src</code></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># vi src/http/ngx_http_header_filter_module.c</span></span></code></pre></div><p>将</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_char ngx_http_server_string[] = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Server: nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CRLF;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_char ngx_http_server_full_string[] = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Server: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NGINX_VER CRLF;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_char ngx_http_server_build_string[] = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Server: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NGINX_VER_BUILD CRLF;</span></span></code></pre></div><p>改为</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_char ngx_http_server_string[] = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Server: webServer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CRLF;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_char ngx_http_server_full_string[] = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Server: webServer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CRLF;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> u_char ngx_http_server_build_string[] = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Server: webServer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CRLF;</span></span></code></pre></div><h2 id="重新编译-nginx" tabindex="-1">重新编译 Nginx <a class="header-anchor" href="#重新编译-nginx" aria-label="Permalink to “重新编译 Nginx”">​</a></h2><p>由于使用宝塔安装 Nginx，所以可以参考宝塔安装脚本：<code>/www/server/panel/install/nginx.sh</code></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1.15&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ];</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ./configure</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user=www</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --group=www</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --prefix=${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Setup_Path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-openssl=${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Setup_Path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}/src/openssl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-module=${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Setup_Path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}/src/ngx_devel_kit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-module=${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Setup_Path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}/src/lua_nginx_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-module=${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Setup_Path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}/src/ngx_cache_purge</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-module=${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Setup_Path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}/src/nginx-sticky-module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_stub_status_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_ssl_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_v2_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_image_filter_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_gzip_static_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_gunzip_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-stream</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-stream_ssl_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-ipv6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_sub_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_flv_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_addition_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_realip_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_mp4_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-ld-opt=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-Wl,-E&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-openssl-opt=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;enable-tls1_3 enable-weak-ssl-ciphers&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-cc-opt=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-Wno-error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${jemallocLD}</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></div><blockquote><p>将 <code>${Setup_Path}</code> 改为 <code>/www/server/nginx</code><br> 将 <code>${jemallocLD}</code> 改为 <code>--with-ld-opt=&quot;-ljemalloc&quot;</code></p></blockquote><p><strong>编译 Nginx</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cd /www/server/nginx/src</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ./configure --user=www --group=www --prefix=/www/server/nginx --with-openssl=/www/server/nginx/src/openssl --add-module=/www/server/nginx/src/ngx_devel_kit --add-module=/www/server/nginx/src/lua_nginx_module --add-module=/www/server/nginx/src/ngx_cache_purge --add-module=/www/server/nginx/src/nginx-sticky-module --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-http_image_filter_module --with-http_gzip_static_module --with-http_gunzip_module --with-stream --with-stream_ssl_module --with-ipv6 --with-http_sub_module --with-http_flv_module --with-http_addition_module --with-http_realip_module --with-http_mp4_module --with-ld-opt=&quot;-Wl,-E&quot; --with-openssl-opt=&quot;enable-tls1_3 enable-weak-ssl-ciphers&quot; --with-cc-opt=&quot;-Wno-error&quot; --with-ld-opt=&quot;-ljemalloc&quot;</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># make &amp;&amp; make install</span></span></code></pre></div><p>重启 Nginx 即可</p>',21)])])}const u=i(e,[["render",n]]);export{o as __pageData,u as default};
