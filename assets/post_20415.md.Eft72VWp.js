import{_ as i,c as e,o as a,aj as r}from"./chunks/framework.DmTz0k4P.js";const g=JSON.parse('{"title":"Supervisor安装以及配置常见问题","description":"","frontmatter":{"date":"2018-08-02 19:13:01","author":"lzw"},"headers":[],"relativePath":"post/20415.md","filePath":"post/2018/08/20415.md","lastUpdated":1710426988000}'),o={name:"post/20415.md"};function l(t,s,d,n,p,h){return a(),e("div",null,[...s[0]||(s[0]=[r(`<h1 id="supervisor安装以及配置常见问题" tabindex="-1">Supervisor安装以及配置常见问题 <a class="header-anchor" href="#supervisor安装以及配置常见问题" aria-label="Permalink to “Supervisor安装以及配置常见问题”">​</a></h1><h2 id="基本思路" tabindex="-1">基本思路： <a class="header-anchor" href="#基本思路" aria-label="Permalink to “基本思路：”">​</a></h2><ol><li>首先我们要明确问题出在supervisor上还是启动的程序上，可以用 <code>ps -ef | grep supervisord</code> 查看是否启动，在用ps查看自己的进程有没有启动；</li><li>确认下启动的supervisor配置文件是哪个，有的是 <code>/etc/supervisor/supervisord.conf</code>，有的是 <code>/etc/supervisord.conf</code>，以自己的为准，不要弄混；</li></ol><p><strong>3. （重点）推荐使用apt-get安装，其次是pip ，最后才是yum。不要问为什么，踩坑踩得。另外，尽量用supervisord 3.x以上的版本，2.x版本出问题概率大；</strong></p><ol start="4"><li>supervisord的日志在 <code>/var/log/supervisor/supervisord.log</code>，启动失败一般能再这里找到有用的信息</li></ol><h2 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to “常用命令”">​</a></h2><p>启动守护进程：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supervisord</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/supervisor/supervisord.conf</span></span></code></pre></div><p>重载配置：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">supervisorctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span></span></code></pre></div><h2 id="具体报错分析" tabindex="-1">具体报错分析 <a class="header-anchor" href="#具体报错分析" aria-label="Permalink to “具体报错分析”">​</a></h2><p>下面是三种常见的通用报错：</p><h3 id="第一类" tabindex="-1">第一类 <a class="header-anchor" href="#第一类" aria-label="Permalink to “第一类”">​</a></h3><p><strong>报错信息：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>error: &lt;class &#39;socket.error&#39;&gt;, [Errno 2] No such file or directory: file: &lt;string&gt; line: 1</span></span></code></pre></div><p><strong>解决办法：</strong><br> 这个可能有多种原因，可能是已经启动过了也可能是没权限，解决步骤如下：</p><ol><li>先要确认是否已经启动过了：<code>ps -ef | grep supervisord</code></li><li>如果有的话先kill掉</li><li>运行下面命令：</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> touch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/supervisor.sock</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 777</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/supervisor.sock</span></span></code></pre></div><ol start="4"><li>再尝试重新启动：<code>supervisord -c /etc/supervisord.conf</code> (如果没有文件找个别人的配置拷贝过来或者运行 <code>echo supervisordconf &gt; /etc/supervisord.conf</code>)</li></ol><h3 id="第二类" tabindex="-1">第二类 <a class="header-anchor" href="#第二类" aria-label="Permalink to “第二类”">​</a></h3><p><strong>报错信息：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Error: .ini file does not include supervisorctl section</span></span></code></pre></div><p><strong>解决办法：</strong><br> 又是一个权限问题的，步骤：</p><ol><li>先确保supervisord.conf中有 <code>[supervisord]</code>，<code>[supervisorctl]</code>有这两个基本模块，还有<code>[program:XXX]</code>自己程序的配置（可以在supervisord.conf也可以在/etc/supervisor/*.ini中）</li><li>最关键的两个命令：<code>chmod +x /usr/bin/supervisord</code> 和 <code>chmod +x /usr/bin/supervisorctl</code></li><li><code>chmod +x /etc/supervisord.conf</code> 主要是把把相关文件都授权了</li><li>把supervisord杀掉后再次启动supervisord</li></ol><h3 id="第三类" tabindex="-1">第三类 <a class="header-anchor" href="#第三类" aria-label="Permalink to “第三类”">​</a></h3><p><strong>报错信息：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Exited too quickly (process log may have details)</span></span></code></pre></div><p>如果前面的问题都解决了，但还是会遇到这个问题，恭喜你已经离胜利很近了，起码supervisord本身已经没什么问题了^^</p><p><strong>解决办法：</strong></p><ol><li>先确认<code>[program:XXX]</code>中自己的程序的<code>command=&lt;启动命令&gt;</code>和 <code>directory=&lt;运行命令的路径&gt;</code>没有问题，python是不是用的自己要的环境的python（比如虚拟环境的），log文件的文件夹是不是已经创建（没创建的话supervisor没权限生成log文件），以及改log文件是不是授权给所有用户了（可参考前面的解决办法 <code>chmod +x aaaaa.log</code>）</li><li>确保用上面的配置中的command在指定路径可以直接运行不会报错，这时候一般就不会有什么问题了。这时候tail你自己的log文件一般就能看到log信息，启动失败报错的信息也会在你的log文件中，照着解决后 <code>supervisorctl reload</code> 就好了。</li><li>如果上面的命令确保可以跑，但还是没法正常运行，也看不到自己程序的报错（不然你就能根据报错解决问题了），那么恭喜，你遇到了跟我一样的情况。我的解决办法很诡异，尝试把 <code>[program:XXX]</code> 中的名字换成了一个跟启动命令不一样的另一个名字（不要太短），reload之后居然就可以跑了。。。。嗯，很不合常理，但是对我来说确实管用了。</li></ol><p><strong>可参考文章：</strong></p><ul><li><a href="http://flowsnow.net/2017/09/25/%E8%AF%A6%E8%A7%A3supervisor%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/" target="_blank" rel="noreferrer">详解supervisor进程管理</a></li><li><a href="https://www.jianshu.com/p/805977544d7f" target="_blank" rel="noreferrer">supervisor 进程管理</a></li></ul>`,32)])])}const k=i(o,[["render",l]]);export{g as __pageData,k as default};
